<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
  <link rel="stylesheet" href="profile.css">
  <link rel="stylesheet" href="dashboard.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
  <button class="hamburger-menu" id="hamburger-menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  
  <div class="sidebar-overlay" id="sidebar-overlay"></div>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>My Account</h2>
      </div>
      <nav class="sidebar-nav">
        <a href="dashboard.html">Dashboard</a>
        <a href="profile.html" class="active">Profile</a>
        <a href="orders.html">Orders</a>
        <a href="shop.html">Shop</a>
        <a href="#">Wishlist</a>
        <a href="notifications.html">Notifications</a>
        <a href="support.html">Support</a>
        <a href="settings.html">Settings</a>
      </nav>
      <div class="sidebar-footer">
        <a href="#" class="logout-btn">Logout</a>
        <a href="#" class="switch-account">Switch account</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <h1>Profile Settings</h1>

      <div id="email-verification-alert" style="display: none;" class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong class="banner-message">A verification link has been sent to your new email address.</strong>
        <button type="button" id="banner-verify-btn" class="btn btn-sm btn-primary ms-3">Resend verification</button>
        <div class="resend-cooldown" id="resend-cooldown" style="display: none; margin-top: 5px; color: #666;">
          <p>You can resend in <span id="countdown-timer">60</span> seconds</p>
        </div>
      </div>

      <!-- Profile Picture -->
      <section class="profile-section">
        <h2>Profile Photo</h2>
        <div class="profile-upload-container">
          <div class="profile-current-photo" id="profileCurrentPhoto">No Photo</div>
          <div class="profile-upload-instructions" id="profileUploadInstructions" style="display: none;">
            <p style="color: #666; font-size: 14px; margin: 15px 0;">Upload a profile picture to personalize your account</p>
          </div>
          <div class="profile-upload-area" id="profileUploadArea" style="display: none;">
            <div class="profile-upload-icon">üìÅ</div>
            <div class="profile-upload-text">Click to upload or drag and drop</div>
            <div class="profile-upload-subtext">PNG, JPG, JPEG up to 5MB</div>
            <input type="file" id="profileFileInput" accept="image/png,image/jpg,image/jpeg" />
          </div>
          <div class="profile-preview-area" id="profilePreviewArea" style="display: none;">
            <img class="profile-preview-image" id="profilePreviewImage" alt="Preview" />
            <div class="profile-preview-info">
              <p>Image ready for upload</p>
              <button class="profile-btn upload-btn-secondary" id="profileReuploadBtn">Choose Different Photo</button>
            </div>
          </div>
          <div class="profile-error-message" id="profileErrorMessage"></div>
          <div class="profile-success-message" id="profileSuccessMessage"></div>
          <div class="profile-progress-container" id="profileProgressContainer">
            <div class="profile-progress-bar">
              <div class="profile-progress-fill" id="profileProgressFill"></div>
            </div>
            <div class="profile-progress-text" id="profileProgressText">Uploading...</div>
          </div>
          <div class="profile-upload-buttons" id="profileUploadButtons" style="display: none;">
            <button class="profile-btn upload-btn-secondary" id="profileCancelUploadBtn">Cancel</button>
            <button class="profile-btn profile-btn-primary" id="profileUploadBtn">Upload Photo</button>
          </div>
        </div>
      </section>

      <!-- Personal Details -->
      <section class="profile-section">
        <h2>Personal Details</h2>
        <div class="profile-info"></div>
        <button class="btn profile-btn-primary" id="edit-details-btn">Update Info</button>
        <form class="profile-form details-form hidden" id="details-form">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" name="name" placeholder="John Doe">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" name="email" placeholder="johndoe@example.com">
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" name="phone" placeholder="+123456789">
          </div>
          <div class="form-group">
            <label>Gender</label>
            <select name="gender" id="select-gender">
              <option selected disabled>Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Country</label>
            <select name="country" id="select-country">
              <option selected disabled>Select Country</option>
              <option>United States</option>
              <option>Mexico</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn profile-btn-primary">Save Changes</button>
            <button type="button" class="btn profile-btn-danger" id="cancel-edit-btn">Cancel</button>
          </div>
        </form>
      </section>

      <!-- Shipping Addresses -->
      <section class="profile-section">
        <h2>Shipping Addresses</h2>
        <div class="address-list" id="address-list">
          <p id="no-addresses-message">No shipping addresses yet. Add your first address!</p>
        </div>
        <button class="btn address-btn address-btn-primary" id="add-address-btn">Add New Address</button>
      </section>

      <!-- Address Modal -->
      <div class="address-modal-overlay" id="address-modal-overlay">
        <div class="address-modal">
          <div class="address-modal-header">
            <h3>Add New Address</h3>
            <button class="address-close-btn" id="address-close-modal">&times;</button>
          </div>
          <form id="address-form">
            <div class="address-form-group">
              <label for="full_name">Full Name <span class="required">*</span></label>
              <input type="text" id="full_name" name="full_name" required>
              <div class="address-error-message" id="full_name_error"></div>
            </div>
            <div class="address-form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" name="phone" placeholder="+1 (555) 123-4567">
              <div class="address-error-message" id="phone_error"></div>
            </div>
            <div class="address-form-group">
              <label for="street">Street Address <span class="required">*</span></label>
              <input type="text" id="street" name="street" placeholder="123 Main Street" required>
              <div class="address-error-message" id="street_error"></div>
            </div>
            <div class="address-form-row">
              <div class="address-form-group">
                <label for="city">City <span class="required">*</span></label>
                <input type="text" id="city" name="city" required>
                <div class="address-error-message" id="city_error"></div>
              </div>
              <div class="address-form-group">
                <label for="state">State/Province</label>
                <input type="text" id="state" name="state" placeholder="Optional">
                <div class="address-error-message" id="state_error"></div>
              </div>
            </div>
            <div class="address-form-row">
              <div class="address-form-group">
                <label for="postal_code">Postal Code <span class="required">*</span></label>
                <input type="text" id="postal_code" name="postal_code" placeholder="12345" required>
                <div class="address-error-message" id="postal_code_error"></div>
              </div>
              <div class="address-form-group">
                <label for="country">Country <span class="required">*</span></label>
                <select id="country" name="country" required>
                  <option value="">Select Country</option>
                </select>
                <div class="address-error-message" id="country_error"></div>
              </div>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="is_default" name="is_default" value="1">
              <label for="is_default">Set as default address</label>
            </div>
            <div class="address-modal-actions">
              <button type="button" class="btn address-btn address-btn-secondary" id="address-cancel-btn">Cancel</button>
              <button type="submit" class="btn address-btn address-btn-primary" id="save-address-btn">Save Address</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Address Delete Modal -->
      <div class="address-delete-modal-overlay" id="address-delete-modal-overlay">
        <div class="address-delete-modal">
          <div class="address-delete-modal-header">
            <h3>Delete Address</h3>
            <button class="address-delete-close-btn" id="address-delete-close-modal">&times;</button>
          </div>
          <div style="padding: 1rem 0;">
            <p>Are you sure you want to delete this address? This action cannot be undone.</p>
          </div>
          <div class="address-delete-modal-actions">
            <button type="button" class="btn address-btn address-btn-secondary" id="address-cancel-delete-btn">Cancel</button>
            <button type="button" class="btn address-btn address-btn-danger" id="address-confirm-delete-btn">Delete Address</button>
          </div>
        </div>
      </div>

      <!-- Toast Notification -->
      <div class="toast" id="toast"></div>

      <!-- Payment Methods Section -->
      <section class="profile-section">
        <h2>Payment Methods</h2>
        <div class="payment-list" id="payment-methods-list">
          <div class="loading" id="payment-methods-loading">
            <p>Loading payment methods...</p>
          </div>
        </div>
        <button class="btn profile-btn-primary" id="add-payment-method-btn">Add New Payment Method</button>
      </section>

      <!-- Payment Method Modal -->
      <div class="payment-modal-overlay" id="payment-modal-overlay">
        <div class="payment-modal">
          <div class="payment-modal-header">
            <h3>Add Payment Method</h3>
            <button class="payment-close-btn" id="payment-close-modal">&times;</button>
          </div>
          <div class="payment-modal-body">
            <form id="payment-add-form">
              <div class="form-group">
                <label>Card Information</label>
                <div id="payment-card-element" style="padding: 12px; border: 1px solid #ddd; border-radius: 4px; background: white;"></div>
                <div id="payment-card-errors" style="color: #fa755a; margin-top: 10px;"></div>
              </div>
              <div class="checkbox-group" style="margin: 15px 0;">
                <input type="checkbox" id="payment-set-default" name="setDefault">
                <label for="payment-set-default">Set as default payment method</label>
              </div>
              <div class="payment-modal-actions">
                <button type="button" class="btn profile-btn-secondary" id="payment-cancel-btn">Cancel</button>
                <button type="submit" class="btn profile-btn-primary" id="payment-save-btn">
                  <span id="payment-save-btn-text">Save Payment Method</span>
                  <span id="payment-save-btn-loading" style="display: none;">Processing...</span>
                </button>
              </div>
            </form>
            <div id="payment-method-errors" style="color: #fa755a; margin-top: 10px; display: none;"></div>
            <div id="payment-method-success" style="color: #00b894; margin-top: 10px; display: none;"></div>
          </div>
        </div>
      </div>

      <!-- Payment Confirmation Modal -->
      <div class="payment-confirm-modal-overlay" id="payment-confirm-overlay">
        <div class="payment-confirm-modal">
          <div class="payment-confirm-modal-header">
            <h3>Confirm Action</h3>
          </div>
          <div class="payment-confirm-modal-body">
            <p id="payment-confirm-message"></p>
            <div class="payment-confirm-modal-actions">
              <button type="button" class="btn profile-btn-secondary" id="payment-confirm-cancel">Cancel</button>
              <button type="button" class="btn profile-btn-danger" id="payment-confirm-action">Confirm</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Logout Confirmation Modal -->
      <div class="logout-modal" id="logout-modal">
        <div class="logout-modal-content">
          <h3>Confirm Logout</h3>
          <p>Are you sure you want to logout?</p>
          <div class="logout-modal-actions">
            <button class="logout-modal-btn logout-cancel" id="logout-cancel">Cancel</button>
            <button class="logout-modal-btn logout-confirm" id="logout-confirm">Logout</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="../frontend/csrf-helper.js"></script>
  <script src="../frontend/toast-helper.js"></script>
  <!-- <script src="https://unpkg.com/imagekit-javascript/dist/imagekit.js"></script> -->
  <script src="general.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script type="module" src="profile.js"></script>
  <script type="module" src="addresses.js"></script>
  <script src="translate-loader.js"></script>
</body>
</html>